@page
@model EcommerceFixed.Pages.products.IndexModel
@{
    ViewData["Title"] = "Colección | Urban Trends";
    var genderFilter = Model.Gender ?? "Todos";
}

<style>
    /* Ocultar barra de scroll pero permitir scroll */
    .hide-scrollbar::-webkit-scrollbar {
        display: none;
    }

    .hide-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    /* 1. Selector de Género (Tabs Superiores) */
    .gender-tabs {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid #eee;
        padding-bottom: 1rem;
    }

    .gender-tab {
        font-family: 'Inter', sans-serif;
        font-weight: 600;
        font-size: 1rem;
        color: #888;
        text-decoration: none;
        padding: 0.5rem 1.5rem;
        border-radius: 50px;
        transition: all 0.3s ease;
        border: 1px solid transparent;
    }

        .gender-tab:hover {
            color: #121212;
            background: #f9f9f9;
        }

        .gender-tab.active {
            color: #fff;
            background: #121212; /* Negro Urban */
            border-color: #121212;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

    /* 2. Slider de Categorías */
    .category-slider-wrapper {
        position: relative;
        margin-bottom: 2rem;
        padding: 0 1rem;
    }

    .category-slider {
        display: flex;
        gap: 12px;
        overflow-x: auto;
        padding: 5px 5px 15px 5px; /* Espacio para la sombra */
        scroll-behavior: smooth;
        white-space: nowrap;
    }

    .cat-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: white;
        border: 1px solid #e0e0e0;
        color: #333;
        padding: 10px 20px;
        border-radius: 12px;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.9rem;
        transition: all 0.2s ease;
        box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        flex-shrink: 0; /* Evita que se aplasten */
    }

        .cat-pill:hover {
            transform: translateY(-2px);
            border-color: #D4AF37;
            color: #D4AF37;
        }

        .cat-pill.active {
            background: #D4AF37;
            color: white;
            border-color: #D4AF37;
            box-shadow: 0 4px 10px rgba(212, 175, 55, 0.3);
        }

    /* 3. Grid de Productos (Cards) */
    .urban-card {
        border: none;
        border-radius: 12px;
        overflow: hidden;
        transition: transform 0.3s;
        height: 100%;
        background: white;
    }

        .urban-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
        }

    .card-img-wrap {
        position: relative;
        aspect-ratio: 3/4;
        overflow: hidden;
    }

        .card-img-wrap img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: 0.5s;
        }

    .urban-card:hover img {
        transform: scale(1.05);
    }

    /* Badges */
    .badge-float {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 2;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Paginación */
    .pagination-container {
        margin-top: 3rem;
        text-align: center;
    }

    .btn-load-more {
        background: white;
        border: 2px solid #121212;
        color: #121212;
        padding: 12px 40px;
        border-radius: 50px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: 0.3s;
    }

        .btn-load-more:hover {
            background: #121212;
            color: white;
            transform: scale(1.05);
        }

</style>

<div class="container" style="padding-top: 2rem; padding-bottom: 4rem;">

    <div class="gender-tabs">
        <a href="/products?Gender=Todos&CategoryId=@Model.CategoryId" class="gender-tab @(string.IsNullOrEmpty(Model.Gender) || Model.Gender == "Todos" ? "active" : "")">
            Todo
        </a>
        <a href="/products?Gender=Mujer&CategoryId=@Model.CategoryId" class="gender-tab @(Model.Gender == "Mujer" ? "active" : "")">
            Mujer
        </a>
        <a href="/products?Gender=Hombre&CategoryId=@Model.CategoryId" class="gender-tab @(Model.Gender == "Hombre" ? "active" : "")">
            Hombre
        </a>
        <a href="/products?Gender=Unisex&CategoryId=@Model.CategoryId" class="gender-tab @(Model.Gender == "Unisex" ? "active" : "")">
            Unisex
        </a>
    </div>

    <div class="category-slider-wrapper">
        <div class="category-slider hide-scrollbar">
            <a href="/products?Gender=@Model.Gender"
               class="cat-pill @(Model.CategoryId == null ? "active" : "")">
                <i class="bi bi-grid-fill"></i> Todo
            </a>

            @foreach (var cat in Model.Categories)
            {
                <a href="/products?Gender=@Model.Gender&CategoryId=@cat.Id"
                   class="cat-pill @(Model.CategoryId == cat.Id ? "active" : "")">
                    @cat.Name
                </a>
            }
        </div>
        <div style="position: absolute; right: 0; top: 0; bottom: 0; width: 50px; background: linear-gradient(to right, transparent, white); pointer-events: none;"></div>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-4 px-2">
        <h5 class="fw-bold mb-0">
            @if (Model.OnSale)
            {
                <span class="text-danger"><i class="bi bi-fire"></i> Ofertas</span>
            }
            else
            {

                <span>Resultados</span>
            }
        </h5>
        <span class="text-muted small">Mostrando @Model.Products.Count productos</span>
    </div>

    @if (Model.Products.Any())
    {
        <div class="row g-3 g-md-4">
            @foreach (var p in Model.Products)
            {
                <div class="col-6 col-md-4 col-lg-3">
                    <div class="urban-card">
                        <div class="card-img-wrap">
                            <a asp-page="./Details" asp-route-id="@p.Id">
                                <img src="@p.ImageLocation" alt="@p.Name" onerror="this.src='https://via.placeholder.com/300x400?text=No+Img'">
                            </a>

                            <div class="badge-float d-flex flex-column gap-1">
                                @if (p.HasDiscount)
                                {
                                    <span class="badge bg-danger rounded-1">-@p.Discount%</span>
                                }
                                @if (p.IsFeatured)
                                {
                                    <span class="badge bg-warning text-dark rounded-1">TOP</span>
                                }
                                @if (p.IsOutOfStock)
                                {
                                    <span class="badge bg-dark rounded-1">AGOTADO</span>
                                }
                            </div>

                            <form method="post" asp-page-handler="AddToWishlist" asp-route-productId="@p.Id" class="position-absolute top-0 end-0 m-2">
                                <button class="btn btn-light rounded-circle shadow-sm p-0 d-flex align-items-center justify-content-center" style="width:32px; height:32px;">
                                    <i class="bi bi-heart text-danger" style="font-size: 0.9rem;"></i>
                                </button>
                            </form>
                        </div>

                        <div class="p-3 text-center">
                            <small class="text-muted text-uppercase" style="font-size: 0.65rem; letter-spacing: 1px;">@p.Category?.Name</small>
                            <h6 class="fw-bold text-dark text-truncate my-1">
                                <a asp-page="./Details" asp-route-id="@p.Id" class="text-decoration-none text-dark">@p.Name</a>
                            </h6>

                            <div class="mb-1 text-warning small">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= p.AverageRating)
                                    {
                                        <i class="bi bi-star-fill"></i>
                                    }
                                    else
                                    {

                                        <i class="bi bi-star text-secondary text-opacity-25"></i>
                                    }
                                }
                            </div>

                            <div class="price-block">
                                @if (p.HasDiscount)
                                {
                                    <span class="text-decoration-line-through text-muted small me-1">@p.Price.ToString("C0")</span>
                                    <span class="text-danger fw-bold">@p.PriceAfterDiscount.ToString("C2")</span>
                                }
                                else
                                {
                                    <span class="fw-bold text-dark">@p.Price.ToString("C2")</span>
                                }
                            </div>

                            @if (!p.IsOutOfStock)
                            {
                                <form method="post" asp-page-handler="AddToCart" asp-route-productId="@p.Id" class="mt-2">
                                    <button class="btn btn-dark w-100 btn-sm rounded-pill">
                                        Agregar
                                    </button>
                                </form>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="pagination-container">
            <p class="text-muted small mb-3">Página @Model.CurrentPage de @Model.TotalPages</p>

            <div class="d-flex justify-content-center gap-2">
                @if (Model.ShowPrevButton)
                {
                    <a href="/products?Gender=@Model.Gender&CategoryId=@Model.CategoryId&CurrentPage=@(Model.CurrentPage - 1)"
                       class="btn btn-outline-dark rounded-pill px-4">
                        <i class="bi bi-arrow-left me-1"></i> Anterior
                    </a>
                }

                @if (Model.ShowNextButton)
                {
                    <a href="/products?Gender=@Model.Gender&CategoryId=@Model.CategoryId&CurrentPage=@(Model.CurrentPage + 1)"
                       class="btn-load-more text-decoration-none">
                        Ver Más Productos <i class="bi bi-arrow-right ms-2"></i>
                    </a>
                }
            </div>
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <i class="bi bi-emoji-neutral display-1 text-muted mb-3"></i>
            <h3>No encontramos productos aquí</h3>
            <p class="text-muted">Intenta seleccionar otra categoría o género.</p>
            <a href="/products" class="btn btn-dark rounded-pill px-4 mt-2">Ver Todo</a>
        </div>
    }
</div>